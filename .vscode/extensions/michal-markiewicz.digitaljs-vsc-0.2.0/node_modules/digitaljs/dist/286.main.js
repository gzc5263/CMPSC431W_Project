!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("digitaljs",[],e):"object"==typeof exports?exports.digitaljs=e():t.digitaljs=e()}(this,(function(){return(()=>{"use strict";var t,e,i={79286:(t,e,i)=>{var s={};i.r(s),i.d(s,{Addition:()=>Wt,AdditionConst:()=>Pe,AdditionConstView:()=>Ne,AdditionView:()=>Xt,And:()=>ht,AndReduce:()=>St,AndReduceView:()=>Pt,AndView:()=>ct,Arith:()=>Mt,Arith11:()=>It,Arith21:()=>Gt,ArithConst:()=>xe,BaseCompare:()=>jt,BaseCompareConst:()=>ke,BitExtend:()=>Ke,BitExtendView:()=>ti,Box:()=>S,BoxView:()=>P,BusGroup:()=>li,BusGroupView:()=>hi,BusRegroup:()=>ai,BusRegroupView:()=>pi,BusSlice:()=>ri,BusSliceView:()=>ni,BusUngroup:()=>ci,BusUngroupView:()=>ui,Button:()=>M,ButtonView:()=>I,Clock:()=>W,ClockView:()=>X,Compare:()=>Et,CompareConst:()=>we,Constant:()=>F,ConstantView:()=>H,Dff:()=>Si,DffView:()=>Pi,Division:()=>Zt,DivisionConst:()=>Ae,DivisionConstView:()=>Oe,DivisionView:()=>Jt,Eq:()=>me,EqCompare:()=>Rt,EqCompareConst:()=>Se,EqConst:()=>Ye,EqConstView:()=>Qe,EqView:()=>_e,FSM:()=>Oi,FSMView:()=>Mi,Gate:()=>x,Gate11:()=>et,GateReduce:()=>st,GateSVG:()=>tt,GateView:()=>v,GateX1:()=>it,Ge:()=>de,GeConst:()=>qe,GeConstView:()=>$e,GeView:()=>ge,GenMux:()=>_i,GenMuxView:()=>fi,Gt:()=>ce,GtConst:()=>We,GtConstView:()=>Xe,GtView:()=>ue,IO:()=>B,IOView:()=>z,Input:()=>A,InputView:()=>O,Lamp:()=>E,LampView:()=>R,Le:()=>le,LeConst:()=>Fe,LeConstView:()=>He,LeView:()=>he,Lt:()=>ae,LtConst:()=>Ue,LtConstView:()=>De,LtView:()=>pe,Memory:()=>Ni,MemoryView:()=>Ci,Modulo:()=>Kt,ModuloConst:()=>Me,ModuloConstView:()=>Ie,ModuloView:()=>te,Multiplication:()=>Yt,MultiplicationConst:()=>Be,MultiplicationConstView:()=>ze,MultiplicationView:()=>Qt,Mux:()=>bi,Mux1Hot:()=>xi,Mux1HotView:()=>vi,MuxSparse:()=>ki,MuxSparseView:()=>wi,MuxView:()=>yi,Nand:()=>gt,NandReduce:()=>Nt,NandReduceView:()=>Ct,NandView:()=>mt,Ne:()=>fe,NeConst:()=>Ze,NeConstView:()=>Je,NeView:()=>be,Negation:()=>Ut,NegationView:()=>Dt,Nor:()=>ut,NorReduce:()=>kt,NorReduceView:()=>wt,NorView:()=>dt,Not:()=>nt,NotView:()=>at,NumBase:()=>C,NumBaseView:()=>V,NumDisplay:()=>U,NumDisplayView:()=>D,NumEntry:()=>G,NumEntryView:()=>L,OpConst:()=>ye,Or:()=>pt,OrReduce:()=>xt,OrReduceView:()=>vt,OrView:()=>lt,Output:()=>T,OutputView:()=>j,Power:()=>ee,PowerConst:()=>Ge,PowerConstView:()=>Le,PowerView:()=>ie,Repeater:()=>ot,RepeaterView:()=>rt,Shift:()=>Tt,ShiftConst:()=>ve,ShiftLeft:()=>se,ShiftLeftConst:()=>Te,ShiftLeftConstView:()=>je,ShiftLeftView:()=>oe,ShiftRight:()=>re,ShiftRightConst:()=>Ee,ShiftRightConstView:()=>Re,ShiftRightView:()=>ne,SignExtend:()=>si,SignExtendView:()=>oi,Subcircuit:()=>gi,SubcircuitView:()=>mi,Subtraction:()=>qt,SubtractionConst:()=>Ce,SubtractionConstView:()=>Ve,SubtractionView:()=>$t,UnaryPlus:()=>Ft,UnaryPlusView:()=>Ht,Wire:()=>k,WireView:()=>w,Xnor:()=>bt,XnorReduce:()=>zt,XnorReduceView:()=>At,XnorView:()=>yt,Xor:()=>_t,XorReduce:()=>Vt,XorReduceView:()=>Bt,XorView:()=>ft,ZeroExtend:()=>ei,ZeroExtendView:()=>ii,portGroupAttrs:()=>y});var o=i(65649),r=i(5238),n=i(3051),a=i(66030),p=i(26528),l=i(14195),h=i(23679),c=i(96486),u=i(89082);const d={tagName:"circle",attributes:{r:7,fill:"black","fill-opacity":.3,stroke:"black","stroke-width":2,cursor:"move"}},g=o.sc.extend(c.merge({},d)),m=o.A_.extend(c.merge({},d)),_=o.zx.extend({update(){return this.relatedView.isShortWire()?(this.options.distance=this.options.distanceShort||this.options.distance,this.options.secondary&&this.hide()):this.options.distance=this.options.distanceLong||this.options.distance,o.zx.prototype.update.apply(this,arguments)}}),f=_.extend({name:"remove",children:o.JW.prototype.children,options:o.JW.prototype.options}),b=_.extend({name:"monitor",children:[{tagName:"circle",selector:"button",attributes:{r:7,fill:"#001DFF",cursor:"pointer"}},{tagName:"path",selector:"icon",attributes:{d:"m -2.5,-0.5 a 2,2 0 1 0 4,0 2,2 0 1 0 -4,0 M 1,1 3,3",fill:"none",stroke:"#FFFFFF","stroke-width":2,"pointer-events":"none"}}],options:{action(t){this.notify("link:monitor")}}}),y={wire:{stroke:"#4B4F6A",x1:0,y1:0,x2:void 0,y2:0},port:{magnet:void 0,r:7,stroke:"black",fill:"white",strokeWidth:2,strokeOpacity:.5},bits:{ref:"port",fill:"black",fontSize:"7pt"},iolabel:{textVerticalAnchor:"middle",fill:"black",fontSize:"8pt"},decor:{stroke:"black",fill:"transparent"}},x=r.TV.define("Gate",{propagation:1,label:"",size:{width:80,height:30},inputSignals:{},outputSignals:{},attrs:{".":{magnet:!1},body:{stroke:"black",strokeWidth:2},text:{fontSize:"8pt",fill:"black"},label:{refX:.5,refDy:3,textAnchor:"middle"}},ports:{groups:{in:{position:"left",attrs:c.merge({},y,{wire:{x2:-25},port:{magnet:"passive",refX:-25},bits:{refDx:1,refY:-3,textAnchor:"start"},iolabel:{refX:5,textAnchor:"start"}})},out:{position:"right",attrs:c.merge({},y,{wire:{x2:25},port:{magnet:!0,refX:25},bits:{refX:-1,refY:-3,textAnchor:"end"},iolabel:{refX:-5,textAnchor:"end"}})}}},z:1},{operation:()=>({}),initialize(){const t=this.get("ports");t.items&&this._preprocessPorts(t.items),r.TV.prototype.initialize.apply(this,arguments),this.prepare(),this.bindAttrToProp("label/text","label"),this._unsupportedPropChanges.length>0&&this.on(this._unsupportedPropChanges.map((t=>"change:"+t)).join(" "),((t,e,i)=>{if(i.init)return;const s=c.intersection(Object.keys(this.changed),this._unsupportedPropChanges);s.forEach((t=>{this.set(t,this.previous(t),{init:!0})})),console.warn('Beta property change support: "'+s+'" changes on '+this.get("type")+" are (currently) not supported.")}))},prepare(){},bindAttrToProp(t,e){this.attr(t,this.get(e)),this.on("change:"+e,((e,i)=>this.attr(t,i)))},_changeOutputSignals(t){c.chain(this.graph.getConnectedLinks(this,{outbound:!0})).groupBy((t=>t.get("source").port)).forEach(((e,i)=>e.forEach((e=>e.set("signal",t[i]))))).value()},_setInput(t,e){const i=c.clone(this.get("inputSignals"));i[e]=t,this.set("inputSignals",i)},_clearInput(t){const e=this.getPort(t).bits;this._setInput(u.Vector3vl.xes(e),t)},_preprocessPorts(t){this._resetPortsSignals(t);for(const e of t){if(e.attrs={},e.attrs.bits={text:this._getBitsText(e.bits)},e.labelled){const t={text:"portlabel"in e?e.portlabel:e.id};!1===e.polarity&&(t["text-decoration"]="overline"),e.decor&&(console.assert("in"==e.group),t.refX=10),e.attrs.iolabel=t}e.decor&&(e.attrs.decor={d:e.decor})}},_setPortsBits(t){const e=c.cloneDeep(this.get("ports")),i=[];for(const s in t){const o=t[s],r=e.items.find((function(t){return t.id&&t.id===s}));r.bits=o,r.attrs.bits.text=this._getBitsText(o),i.push(r)}this._resetPortsSignals(i),this.set("ports",e),this.graph.getConnectedLinks(this,{outbound:!0}).filter((e=>e.get("source").port in t)).forEach((t=>t._changeSource(t.get("source")))),this.graph.getConnectedLinks(this,{inbound:!0}).filter((e=>e.get("target").port in t)).forEach((t=>t._changeTarget(t.get("target"))))},_getBitsText:t=>t>1?t:"",_resetPortValue:t=>u.Vector3vl.xes(t.bits),_resetPortsSignals(t){const e={in:this.get("inputSignals"),out:this.get("outputSignals")};for(const i of t)console.assert(i.bits>=0),e[i.dir][i.id]=this._resetPortValue(i);this.set("inputSignals",e.in),this.set("outputSignals",e.out)},_removePortsSignals(t){const e={in:this.get("inputSignals"),out:this.get("outputSignals")};for(const i of t)delete e[i.dir][i.id];this.set("inputSignals",e.in),this.set("outputSignals",e.out)},addPort(t){this.addPorts([t])},addPorts(t){this._preprocessPorts(t),r.TV.prototype.addPorts.apply(this,arguments)},removePort(t,e){this.removePorts([t])},removePorts(t,e){this._removePortsSignals(t),r.TV.prototype.removePorts.apply(this,arguments)},_getStackedPosition:t=>function(e,i){const s=t.side||"left",o=t.step||16,r=t.offset||12,n="left"==s?i.topLeft().x:"right"==s?i.topRight().x:void 0,a="top"==s?i.topLeft().y:"bottom"==s?i.bottomRight().y:void 0;return void 0!==n?c.map(e,(function(t,e){return e+=t.idxOffset||0,h.E({x:n,y:e*o+r})})):c.map(e,(function(t,e){return e+=t.idxOffset||0,h.E({x:e*o+r,y:a})}))},getLayoutSize(){return this.size()},setLayoutPosition(t){this.set("position",{x:t.x,y:t.y})},portMarkup:[{tagName:"line",className:"wire",selector:"wire"},{tagName:"circle",className:"port",selector:"port"},{tagName:"text",className:"bits",selector:"bits"},{tagName:"text",className:"iolabel",selector:"iolabel"},{tagName:"path",className:"decor",selector:"decor"}],markup:[{tagName:"text",className:"label",selector:"label"}],getGateParams(t){return c.cloneDeep(c.pick(this.attributes,this._gateParams.concat(t?this._gateLayoutParams:[])))},_gateParams:["label","type","propagation","source_positions"],_gateLayoutParams:["position"],_unsupportedPropChanges:[],_operationHelpers:[],_presentationParams:[]}),v=a.Z.extend({attrs:{signal:{high:{port:{stroke:"#03c03c"}},low:{port:{stroke:"#fc7c68"}},def:{port:{stroke:"#779ecb"}},undef:{port:{stroke:"#999"}}}},presentationAttributes:a.Z.addPresentationAttributes({inputSignals:"SIGNAL",outputSignals:"SIGNAL2"}),stopprop(t){t.stopPropagation()},confirmUpdate(t){this.hasFlag(t,"SIGNAL")&&this._updatePortSignals("in"),this.hasFlag(t,"SIGNAL2")&&this._updatePortSignals("out"),a.Z.prototype.confirmUpdate.apply(this,arguments)},_updatePortSignals(t){const e="in"===t?this.model.get("inputSignals"):"out"===t?this.model.get("outputSignals"):c.merge({},this.model.get("inputSignals"),this.model.get("outputSignals"));for(const t in e){const i=e[t],s=this.attrs.signal[i.isDefined?i.isHigh?"high":i.isLow?"low":"def":"undef"];this._applyPortAttrs(t,s)}},_applyAttrs(t){for(const e in t){const i=this.selectors[e];this.setNodeAttributes(i,t[e])}},_applyPortAttrs(t,e){if(t in this._portElementsCache)for(const i in e){const s=this._portElementsCache[t].portSelectors[i];this.setNodeAttributes(s,e[i])}},_updatePorts(){a.Z.prototype._updatePorts.apply(this,arguments),this._updatePortSignals()}}),k=n.rU.define("Wire",{attrs:{line:{class:"connection",targetMarker:null},wrapper:{stroke:"red"}},signal:u.Vector3vl.xes(1),bits:1,warning:!1,z:0},{initialize(){n.rU.prototype.initialize.apply(this,arguments),this.has("netname")&&this.label(0,{markup:[{tagName:"text",selector:"label"}],attrs:{label:{text:this.get("netname"),fill:"black",fontSize:"8pt"}},position:{distance:.5}})},onAdd(){this._changeSource(this.get("source")),this._was_added=!0},remove(){const t=this.get("target"),e=this.graph.getCell(t.id);e&&"port"in t&&e._clearInput(t.port),n.rU.prototype.remove.apply(this,arguments)},_propagateSignal(t,e){const i=this.getTargetElement();i&&(this.get("warning")?i._clearInput(t.port):i._setInput(e,t.port))},_changeSignal(t){this._propagateSignal(this.get("target"),t)},_changeSource(t){const e=this.getSourceElement();e&&"port"in t?(this.set("bits",e.getPort(t.port).bits),this._checkConnection(),this.set("signal",e.get("outputSignals")[t.port])):this.set("signal",u.Vector3vl.xes(this.get("bits")))},_changeTarget(t){if(this._checkConnection(),"port"in t&&this._propagateSignal(t,this.get("signal")),!this.hasChanged("target"))return;const e=this.previous("target"),i=this.graph.getCell(e.id);i&&"port"in e&&i._clearInput(e.port)},_checkConnection(){const t=this.get("target"),e=this.graph.getCell(t.id);this.set("warning",e&&e.getPort(t.port).bits!==this.get("bits")||!1,{silent:!this._was_added})},getWireParams(t){const e={from:{id:this.get("source").id,port:this.get("source").port},to:{id:this.get("target").id,port:this.get("target").port}};return this.has("netname")&&(e.name=this.get("netname")),t&&this.has("vertices")&&this.get("vertices").length>0&&(e.vertices=c.cloneDeep(this.get("vertices"))),e},getWirePath(){const t=[];for(let e=this.graph.get("subcircuit");null!=e;e=e.graph.get("subcircuit")){if(!e.has("label"))return null;t.push(e.get("label"))}return t.reverse()}}),w=p.t.extend({initFlag:p.t.prototype.initFlag.concat(["INIT"]),longWireLength:400,attrs:{signal:{high:{line:{stroke:"#03c03c"}},low:{line:{stroke:"#fc7c68"}},def:{line:{stroke:"#779ecb"}},undef:{line:{stroke:"#999"}}},bits:{bus:{line:{"stroke-width":"4px"}},single:{line:{"stroke-width":"2px"}}},warning:{warn:{wrapper:{"stroke-opacity":"0.5"}},none:{wrapper:{"stroke-opacity":"0"}}}},_wireToolsView:"undefined"!=typeof window?new l.I({tools:[new o.UM({focusOpacity:.5}),new g,new m,new f({distanceShort:"75%",distanceLong:"50"}),new f({distance:"-50",secondary:!0}),new b({distanceShort:"25%",distanceLong:"30"}),new b({distance:"-30",secondary:!0})]}):null,presentationAttributes:p.t.addPresentationAttributes({signal:"SIGNAL",bits:"BITS",warning:"WARNING"}),initialize(){p.t.prototype.initialize.apply(this,arguments),this.prevModels={source:null,target:null}},confirmUpdate(t){p.t.prototype.confirmUpdate.apply(this,arguments),this.hasFlag(t,"SIGNAL")&&this._updateSignal(),this.hasFlag(t,"BITS")&&this._updateBits(),this.hasFlag(t,"WARNING")&&this._updateWarning()},isShortWire(){return this.getConnectionLength()<this.longWireLength},_updateSignal(){const t=this.model.get("signal"),e=this.attrs.signal[t.isDefined?t.isHigh?"high":t.isLow?"low":"def":"undef"];this._applyAttrs(e)},_updateBits(){const t=this.model.get("bits"),e=this.attrs.bits[t>1?"bus":"single"];this._applyAttrs(e)},_updateWarning(){const t=this.model.get("warning"),e=this.attrs.warning[t?"warn":"none"];this._applyAttrs(e)},_applyAttrs(t){for(const e in t){const i=this.selectors[e];this.setNodeAttributes(i,t[e])}},update(){p.t.prototype.update.apply(this,arguments),this._updateSignal(),this._updateBits(),this._updateWarning()},onRemove(){p.t.prototype.onRemove.apply(this,arguments),this._removeTooltip()},mouseenter(t){p.t.prototype.mouseenter.apply(this,arguments),this.addTools(this._wireToolsView),this._addTooltip({x:t.clientX+5,y:t.clientY+5})},mouseleave(t){p.t.prototype.mouseleave.apply(this,arguments),this.removeTools(),this._removeTooltip()},_addTooltip(t){1!=this.model.get("bits")&&(this.wire_hover||(this.wire_hover=$('<div class="wire_hover">').css("left",t.x).css("top",t.y).appendTo($(document.body)),this._generateTextForTooltip(),this.listenTo(this.model,"change:signal",this._generateTextForTooltip)))},_removeTooltip(){this.wire_hover&&(this.wire_hover.remove(),this.wire_hover=null,this.stopListening(this.model,"change:signal",this._generateTextForTooltip))},_generateTextForTooltip(){if(!this.wire_hover)return;const t=this.model.get("signal"),e=this.model.graph._display3vl,i=["Hex: "+e.show("hex",t)+"<br>","Dec: "+e.show("dec",t)+"<br>","Oct: "+e.show("oct",t)+"<br>","Bin: "+e.show("bin",t)].join("");this.wire_hover.html(i)},onEndModelChange(t,e,i){"object"==typeof e&&null!=e&&e==this.prevModels[t]&&Object.keys(e.changed).length>0&&!("position"in e.changed)||(p.t.prototype.onEndModelChange.apply(this,arguments),this.prevModels[t]=e)}}),S=x.define("Box",{attrs:{body:{refWidth:1,refHeight:1},tooltip:{refX:0,refY:-30,height:30}}},{initialize(){x.prototype.initialize.apply(this,arguments),this.on("change:size",((t,e)=>{e.width>this.tooltipMinWidth?this.attr("tooltip",{refWidth:1,width:null}):this.attr("tooltip",{refWidth:null,width:this.tooltipMinWidth})})),this.trigger("change:size",this,this.prop("size"))},markup:x.prototype.markup.concat([{tagName:"rect",className:"body",selector:"body"}]),markupZoom:[{tagName:"foreignObject",className:"tooltip",selector:"tooltip",children:[{tagName:"body",namespaceURI:"http://www.w3.org/1999/xhtml",children:[{tagName:"a",className:"zoom",textContent:"🔍",style:{cursor:"pointer"}}]}]}],tooltipMinWidth:20,decorClock:"M"+[[0,-6],[6,0],[0,6]].map((t=>t.join(" "))).join(" L")}),P=v.extend({_autoResizeBox:!1,render(){v.prototype.render.apply(this,arguments),this._autoResizeBox&&!this.model.get("box_resized")&&(this.model.set("box_resized",!0),this.model.prop("size/width",this._calculateBoxWidth()))},_calculateBoxWidth(){const t=Array.from(this.el.querySelectorAll("[port-group=in] > text.iolabel")),e=Array.from(this.el.querySelectorAll("[port-group=out] > text.iolabel")),i=Math.max(...t.map((t=>t.getBBox().width))),s=Math.max(...e.map((t=>t.getBBox().width))),o=t=>t==-1/0?-5:t;return o(i)+o(s)+25}});var N=i(9983);const C=S.define("NumBase",{numbase:"hex",bits:1},{initialize(){S.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this.graph._display3vl.usableDisplays(this.numbaseType,this.get("bits")).includes(this.get("numbase"))||this.set("numbase","hex")}))},tooltipMinWidth:70,markupTooltip:[{tagName:"foreignObject",className:"tooltip",selector:"tooltip",children:[{tagName:"body",namespaceURI:"http://www.w3.org/1999/xhtml",children:[{tagName:"select",className:"numbase"}]}]}],_gateParams:S.prototype._gateParams.concat(["numbase"])}),V=P.extend({presentationAttributes:P.addPresentationAttributes({bits:"BITS",numbase:"NUMBASE"}),_autoResizeBox:!0,events:{"click select.numbase":"stopprop","mousedown select.numbase":"stopprop","touchstart select.numbase":"stopprop","change select.numbase":"_changeNumbase"},_changeNumbase(t){this.model.set("numbase",t.target.value||"bin")},_calculateBoxWidth(){const t=document.createElementNS("http://www.w3.org/2000/svg","text");N(t).text(Array(this.model.get("bits")).fill("0").join("")).attr("class","numvalue").appendTo(this.$el);const e=t.getBBox().width+20;return t.remove(),e},confirmUpdate(t){P.prototype.confirmUpdate.apply(this,arguments),(this.hasFlag(t,"BITS")||this.hasFlag(t,"RENDER"))&&this._makeNumBaseSelector(),this.hasFlag(t,"NUMBASE")&&this._updateNumBaseSelector()},_makeNumBaseSelector(){this.$("select.numbase").empty();const t=this.model.get("numbase"),e=this.model.graph._display3vl;for(const i of e.usableDisplays(this.model.numbaseType,this.model.get("bits")))N("<option>").attr("value",i).prop("selected",i==t).text(i).appendTo(this.$("select.numbase"))},_updateNumBaseSelector(){this.$("select.numbase").val(this.model.get("numbase"))}}),B=C.define("IO",{bits:1,net:"",propagation:0,mode:-1,attrs:{ioname:{refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",fontWeight:"bold",fontSize:"10pt"}}},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:this._portDirection,group:this._portDirection,dir:this._portDirection,bits:t}],C.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{const i={};i[this._portDirection]=e,this._setPortsBits(i),0!=this.get("mode")&&this._checkMode()})),this.bindAttrToProp("text.ioname/text","net")},onAdd(){this._checkMode()},_checkMode(){const t=this.graph&&this.graph.has("subcircuit"),e=this.get("bits"),i=t?0:1==e?1:2;return this.set("mode",i),this.set("box_resized",!1),this.set("markup",0==i?this.markupInSubcircuit:1==i?this.markupSingle:this.markupBus),i},_setPortsBits(t){if(C.prototype._setPortsBits.apply(this,arguments),0!=this.get("mode"))return;const e=this.graph.get("subcircuit");console.assert(null!=e);const i={};i[this.get("net")]=t[this._portDirection],e._setPortsBits(i)},markupSingle:C.prototype.markup,markupBus:C.prototype.markup.concat(C.prototype.markupTooltip),markupInSubcircuit:C.prototype.markup.concat([{tagName:"text",className:"ioname",selector:"ioname"}]),_gateParams:C.prototype._gateParams.concat(["bits","net"])}),z=V.extend({_calculateBoxWidth(){switch(this.model.get("mode")){case 0:const t=this.selectors.ioname;return"none"!==t.getAttribute("display")?t.getBBox().width+10:20;case 1:return 30;case 2:return V.prototype._calculateBoxWidth.call(this)}}}),A=B.define("Input",{attrs:{btnface:{stroke:"black",strokeWidth:2,refX:.2,refY:.2,refHeight:.6,refWidth:.6,cursor:"pointer"},"foreignObject.valinput":{refX:.5,refY:.5,refWidth:-10,refHeight:-10,xAlignment:"middle",yAlignment:"middle"}}},{isInput:!0,_portDirection:"out",_resetPortValue(t){if("out"==t.id&&"out"==t.dir){const t=this.get("bits");return 1==this.get("mode")?u.Vector3vl.zeros(t):u.Vector3vl.xes(t)}return B.prototype._resetPortValue.call(this,t)},_checkMode(){B.prototype._checkMode.call(this),this._resetPortsSignals([this.get("ports").items[0]])},setInput(t){this._setInput(t),this.trigger("userChange",this)},toggleInput(){this.setInput(this.get("outputSignals").out.not())},_setInput(t){if(t.bits!=this.get("bits"))throw new Error("setInput: wrong number of bits");this.set("outputSignals",{out:t})},markupSingle:B.prototype.markupSingle.concat([{tagName:"rect",className:"btnface",selector:"btnface"}]),markupBus:B.prototype.markupBus.concat([{tagName:"foreignObject",className:"valinput",children:[{tagName:"body",namespaceURI:"http://www.w3.org/1999/xhtml",children:[{tagName:"input",attributes:{type:"text"}}]}]}]),numbaseType:"read"}),O=z.extend({attrs:c.merge({button:{high:{btnface:{fill:"black"}},low:{btnface:{fill:"white"}}}},z.prototype.attrs),confirmUpdate(t){z.prototype.confirmUpdate.apply(this,arguments),(this.hasFlag(t,"SIGNAL2")||this.hasFlag(t,"NUMBASE"))&&this._updateView()},_updateView(){switch(this.model.get("mode")){case 1:this._updateButton();break;case 2:this._updateNumEntry()}},_updateButton(){const t=this.model.get("outputSignals").out,e=this.attrs.button[t.isHigh?"high":"low"];this._applyAttrs(e)},_updateNumEntry(){const t=this.model.graph._display3vl;this.$("input").val(t.show(this.model.get("numbase"),this.model.get("outputSignals").out)),this.$("input").removeClass("invalid")},render(){z.prototype.render.apply(this,arguments),this._updateView()},events:c.merge({"click .btnface":"_onButton","mousedown .btnface":"stopprop","touchstart .btnface":"stopprop","click input":"stopprop","mousedown input":"stopprop","touchstart input":"stopprop","change input":"_onNumEntry"},V.prototype.events),_onButton(){this.model.toggleInput()},_onNumEntry(t){const e=this.model.get("numbase"),i=this.model.get("bits"),s=this.model.graph._display3vl;if(s.validate(e,t.target.value,i)){const o=s.read(e,t.target.value,i);this.model.setInput(o)}else this.$("input").addClass("invalid")}}),M=A,I=O,G=A,L=O,T=B.define("Output",{attrs:{led:{refX:.5,refY:.5,refR:.35},value:{refX:.5,refY:.5,textVerticalAnchor:"middle",text:"0"}}},{isOutput:!0,_portDirection:"in",getOutput(){return this.get("inputSignals").in},markupSingle:B.prototype.markupSingle.concat([{tagName:"circle",className:"led",selector:"led"}]),markupBus:B.prototype.markupBus.concat([{tagName:"text",className:"value numvalue",selector:"value"}]),numbaseType:"show"}),j=z.extend({attrs:c.merge({lamp:{high:{led:{fill:"#03c03c"}},low:{led:{fill:"#fc7c68"}},undef:{led:{fill:"#bfc5c6"}}}},z.prototype.attrs),confirmUpdate(t){z.prototype.confirmUpdate.apply(this,arguments),(this.hasFlag(t,"SIGNAL")||this.hasFlag(t,"NUMBASE"))&&this._updateView()},_updateView(){switch(this.model.get("mode")){case 1:this._updateLamp();break;case 2:this._updateNumDisplay()}},_updateLamp(){const t=this.model.get("inputSignals").in,e=this.attrs.lamp[t.isHigh?"high":t.isLow?"low":"undef"];this._applyAttrs(e)},_updateNumDisplay(){const t=this.model.graph._display3vl;this.$("text.value tspan").text(t.show(this.model.get("numbase"),this.model.get("inputSignals").in))},render(){z.prototype.render.apply(this,arguments),this._updateView()}}),E=T,R=j,U=T,D=j,F=C.define("Constant",{constant:"0",propagation:0,attrs:{value:{refX:.5,refY:.5,textVerticalAnchor:"middle",text:"0"}}},{initialize(){const t=this.get("constant").length;this.set("bits",t),this.get("ports").items=[{id:"out",group:"out",dir:"out",bits:t}],C.prototype.initialize.apply(this,arguments),this.on("change:constant",((t,e)=>{const i=e.length;this._setPortsBits({out:i}),this.set("bits",i),this.set("constantCache",u.Vector3vl.fromBin(e,i))}))},prepare(){const t=this.get("constant"),e=t.length;this.set("constantCache",u.Vector3vl.fromBin(t,e))},operation(){return{out:this.get("constantCache")}},markup:C.prototype.markup.concat([{tagName:"text",className:"value numvalue",selector:"value"}]),_gateParams:C.prototype._gateParams.concat(["constant"]),numbaseType:"show"}),H=V.extend({presentationAttributes:V.addPresentationAttributes({constantCache:"CONSTANT"}),confirmUpdate(t){V.prototype.confirmUpdate.apply(this,arguments),(this.hasFlag(t,"CONSTANT")||this.hasFlag(t,"NUMBASE"))&&this._showText()},_showText(){const t=this.model.graph._display3vl;this.$("text.value tspan").text(t.show(this.model.get("numbase"),this.model.get("constantCache")))},update(){V.prototype.update.apply(this,arguments),this._showText()}}),W=S.define("Clock",{propagation:100,ports:{items:[{id:"out",group:"out",dir:"out",bits:1}]},size:{width:30,height:30}},{_resetPortValue:t=>"out"==t.id&&"out"==t.dir?u.Vector3vl.zero:S.prototype._resetPortValue(t),operation(){return{out:this.get("outputSignals").out.not(),_clock_hack:!0}},tooltipMinWidth:55,markup:S.prototype.markup.concat([{tagName:"path",className:"decor",attributes:{d:"M7.5 7.5 L7.5 22.5 L15 22.5 L15 7.5 L22.5 7.5 L22.5 22.5",stroke:"black"}},{tagName:"foreignObject",className:"tooltip",selector:"tooltip",children:[{tagName:"body",namespaceURI:"http://www.w3.org/1999/xhtml",children:[{tagName:"input",attributes:{type:"number",min:1,step:1}}]}]}]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["bits"])}),X=P.extend({presentationAttributes:P.addPresentationAttributes({propagation:"SIGNAL"}),events:{"click input":"stopprop","mousedown input":"stopprop","touchstart input":"stopprop","change input":"_changePropagation","input input":"_changePropagation"},render(t){P.prototype.render.apply(this,arguments),this.updatePropagation()},confirmUpdate(t){P.prototype.confirmUpdate.apply(this,arguments),this.hasFlag(t,"SIGNAL")&&this.updatePropagation()},_changePropagation(t){const e=t.target.value,i=String(e)==String(Number(e));i&&this.model.set("propagation",Number(e)||1),this.$("input").toggleClass("invalid",!i)},updatePropagation(){this.$("input").val(this.model.get("propagation"))}}),q="M19 0v32h16c9 0 16-7 16-16S44 0 35 0H20z",Y="M14.3 0l1.6 2s4.5 5.6 4.5 14s-4.5 14-4.5 14l-1.6 2H28c3.8 0 16.6-.5 25-16h0A28 28 0 0028 0H16.8z",Q="M18-2v36l2-1 32-17h0L20-1z",Z={tagName:"path",selector:"xor_arc",attributes:{fill:"#000",d:"M6.8-1.2 10 2.7S14.2 8 14.2 16S10 29.3 10 29.3l-3.2 3.9H10l1.7-2.4s4.8-6 4.8-14.8c0-8.9-4.8-14.8-4.8-14.8l-1.7-2.4z"}},J={tagName:"circle",className:"body",selector:"neg_bubble",attributes:{stroke:"#000","stroke-width":"2px",cx:56,cy:16,r:4}};function K(t=[]){return{tagName:"g",selector:"body",children:[{tagName:"path",className:"body gate",selector:"gate"}].concat(t)}}const tt=x.define("GateSVG",{bits:1,size:{width:60,height:32},ports:{groups:{in:{position:{name:"left",args:{dx:30}},attrs:{wire:{x2:-50},port:{refX:-50}},z:-1},out:{position:{name:"right",args:{dx:-30}},attrs:{wire:{x2:50},port:{refX:50}},z:-1}}}},{markup:x.prototype.markup.concat([K()]),_gateParams:x.prototype._gateParams.concat(["bits"])}),et=tt.define("Gate11",{},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t},{id:"out",group:"out",dir:"out",bits:t}],tt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits({in:e,out:e})}))}}),it=tt.define("GateX1",{inputs:2,attrs:{gate:{"vector-effect":"non-scaling-stroke"},xor_arc:{"vector-effect":"non-scaling-stroke"},neg_bubble:{"vector-effect":"non-scaling-stroke"}}},{initialize(){const t=this.get("bits"),e=this.get("inputs"),i=[];for(let s=1;s<=e;s++)i.push({id:"in"+s,group:"in",dir:"in",bits:t});i.push({id:"out",group:"out",dir:"out",bits:t}),this.get("ports").items=i;const s=e/2;this.set("size",{width:60*s,height:32*s}),this.attr("body/transform","translate(-4, 0) scale("+s+")"),this.prop("ports/groups/in/position/args/dx",30*s),this.prop("ports/groups/in/attrs/wire/x2",-30*s-20),this.prop("ports/groups/in/attrs/port/refX",-30*s-20),this.prop("ports/groups/out/position/args/dx",-30*s),this.prop("ports/groups/out/attrs/wire/x2",30*s+20),this.prop("ports/groups/out/attrs/port/refX",30*s+20),tt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{const i=this.get("inputs"),s={out:e};for(let t=1;t<=i;t++)s["in"+t]=e;this._setPortsBits(s)}))},operation(t){let e=t.in1;for(let i=2;i<=this.get("inputs");i++)e=this.binoperation(e,t["in"+i]);return{out:this.finoperation(e)}},finoperation:t=>t,_gateParams:tt.prototype._gateParams.concat(["inputs"]),_unsupportedPropChanges:tt.prototype._unsupportedPropChanges.concat(["inputs"]),_operationHelpers:tt.prototype._operationHelpers.concat(["binoperation","finoperation"])}),st=tt.define("GateReduce",{},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t},{id:"out",group:"out",dir:"out",bits:1}],tt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits({in:e})}))}}),ot=et.define("Repeater",{attrs:{gate:{d:Q}}},{operation:t=>({out:t.in})}),rt=v,nt=et.define("Not",{attrs:{gate:{d:Q}}},{operation:t=>({out:t.in.not()}),markup:x.prototype.markup.concat([K([J])])}),at=v,pt=it.define("Or",{attrs:{gate:{d:Y}}},{binoperation:(t,e)=>t.or(e)}),lt=v,ht=it.define("And",{attrs:{gate:{d:q}}},{binoperation:(t,e)=>t.and(e)}),ct=v,ut=it.define("Nor",{attrs:{gate:{d:Y}}},{binoperation:(t,e)=>t.or(e),finoperation:t=>t.not(),markup:x.prototype.markup.concat([K([J])])}),dt=v,gt=it.define("Nand",{attrs:{gate:{d:q}}},{binoperation:(t,e)=>t.and(e),finoperation:t=>t.not(),markup:x.prototype.markup.concat([K([J])])}),mt=v,_t=it.define("Xor",{attrs:{gate:{d:Y}}},{binoperation:(t,e)=>t.xor(e),markup:x.prototype.markup.concat([K([Z])])}),ft=v,bt=it.define("Xnor",{attrs:{gate:{d:Y}}},{binoperation:(t,e)=>t.xor(e),finoperation:t=>t.not(),markup:x.prototype.markup.concat([K([Z,J])])}),yt=v,xt=st.define("OrReduce",{attrs:{gate:{d:Y}}},{operation:t=>({out:t.in.reduceOr()})}),vt=v,kt=st.define("NorReduce",{attrs:{gate:{d:Y}}},{operation:t=>({out:t.in.reduceNor()}),markup:st.prototype.markup.concat([J])}),wt=v,St=st.define("AndReduce",{attrs:{gate:{d:q}}},{operation:t=>({out:t.in.reduceAnd()})}),Pt=v,Nt=st.define("NandReduce",{attrs:{gate:{d:q}}},{operation:t=>({out:t.in.reduceNand()}),markup:x.prototype.markup.concat([K([J])])}),Ct=v,Vt=st.define("XorReduce",{attrs:{gate:{d:Y}}},{operation:t=>({out:t.in.reduceXor()}),markup:x.prototype.markup.concat([K([Z])])}),Bt=v,zt=st.define("XnorReduce",{attrs:{gate:{d:Y}}},{operation:t=>({out:t.in.reduceXnor()}),markup:x.prototype.markup.concat([K([Z,J])])}),At=v;function Ot(t){return t<=Number.MAX_SAFE_INTEGER&&t>=-Number.MAX_SAFE_INTEGER}const Mt=x.define("Arith",{size:{width:40,height:40},attrs:{body:{refR:.5,refCx:.5,refCy:.5},oper:{refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",fontSize:"12pt"}},ports:{groups:{in:{position:{name:"left",args:{dx:10}},attrs:{wire:{x2:-35},port:{refX:-35}},z:-1},out:{position:{name:"right",args:{dx:-10}},attrs:{wire:{x2:35},port:{refX:35}},z:-1}}}},{markup:x.prototype.markup.concat([{tagName:"circle",className:"body",selector:"body"},{tagName:"text",className:"oper",selector:"oper"}]),_gateParams:x.prototype._gateParams.concat(["bits","signed"]),_unsupportedPropChanges:x.prototype._unsupportedPropChanges.concat(["signed"])}),It=Mt.define("Arith11",{bits:{in:1,out:1},signed:!1},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.in},{id:"out",group:"out",dir:"out",bits:t.out}],Mt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits(e)}))},operation(t){const e=this.get("bits");return t.in.isFullyDefined?{out:u.Vector3vl.fromNumber(this.arithop(t.in.toBigInt(this.get("signed"))),e.out)}:{out:u.Vector3vl.xes(e.out)}},_operationHelpers:Mt.prototype._operationHelpers.concat(["arithop"])}),Gt=Mt.define("Arith21",{bits:{in1:1,in2:1,out:1},signed:{in1:!1,in2:!1}},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in1",group:"in",dir:"in",bits:t.in1},{id:"in2",group:"in",dir:"in",bits:t.in2},{id:"out",group:"out",dir:"out",bits:t.out}],Mt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits(e)}))},operation(t){const e=this.get("bits"),i=this.get("signed");return t.in1.isFullyDefined&&t.in2.isFullyDefined?{out:u.Vector3vl.fromNumber(this.arithop(t.in1.toBigInt(i.in1&&i.in2),t.in2.toBigInt(i.in1&&i.in2)),e.out)}:{out:u.Vector3vl.xes(e.out)}},_operationHelpers:Mt.prototype._operationHelpers.concat(["arithop"])});function Lt(t,e,i,s,o,r,n){const a=t.get(t.bits-1),p=u.Vector3vl.make(Math.max(0,s-i),n?0:o?a:-1),l=t.concat(p);return(e<0?u.Vector3vl.make(-e,n?0:-1).concat(l):l.slice(e).concat(u.Vector3vl.make(e,n?0:r?l.get(l.bits-1):-1))).slice(0,s)}const Tt=Mt.define("Shift",{bits:{in1:1,in2:1,out:1},signed:{in1:!1,in2:!1,out:!1},fillx:!1},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in1",group:"in",dir:"in",bits:t.in1},{id:"in2",group:"in",dir:"in",bits:t.in2},{id:"out",group:"out",dir:"out",bits:t.out}],Mt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits(e)}))},operation(t){const e=this.get("bits"),i=this.get("signed"),s=this.get("fillx");if(!t.in2.isFullyDefined)return{out:u.Vector3vl.xes(e.out)};const o=t.in2.toNumber(i.in2)*this.shiftdir;return{out:Lt(t.in1,o,e.in1,e.out,i.in1,i.out,s)}},_gateParams:Mt.prototype._gateParams.concat(["fillx"]),_unsupportedPropChanges:Mt.prototype._unsupportedPropChanges.concat(["fillx"]),_operationHelpers:Mt.prototype._operationHelpers.concat(["shiftdir"])}),jt=Mt.define("BaseCompare",{bits:{in1:1,in2:1},signed:{in1:!1,in2:!1}},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in1",group:"in",dir:"in",bits:t.in1},{id:"in2",group:"in",dir:"in",bits:t.in2},{id:"out",group:"out",dir:"out",bits:1}],Mt.prototype.initialize.apply(this,arguments),this.on("change:bits",((t,e)=>{this._setPortsBits(e)}))}}),Et=jt.define("Compare",{},{operation(t){this.get("bits");const e=this.get("signed");return t.in1.isFullyDefined&&t.in2.isFullyDefined?{out:u.Vector3vl.fromBool(this.arithcomp(t.in1.toBigInt(e.in1&&e.in2),t.in2.toBigInt(e.in1&&e.in2)))}:{out:u.Vector3vl.xes(1)}},_operationHelpers:jt.prototype._operationHelpers.concat(["arithcomp"])}),Rt=jt.define("EqCompare",{},{operation(t){const e=this.get("bits"),i=this.get("signed"),s=e.in1>=e.in2?t.in1:t.in1.concat(u.Vector3vl.make(e.in2-e.in1,i.in1&&i.in2?t.in1.msb:-1)),o=e.in2>=e.in1?t.in2:t.in2.concat(u.Vector3vl.make(e.in1-e.in2,i.in1&&i.in2?t.in2.msb:-1));return{out:this.bincomp(s,o)}},_operationHelpers:jt.prototype._operationHelpers.concat(["bincomp"])}),Ut=It.define("Negation",{attrs:{oper:{text:"-"}}},{arithop:t=>-t}),Dt=v,Ft=It.define("UnaryPlus",{attrs:{oper:{text:"+"}}},{arithop:t=>t}),Ht=v,Wt=Gt.define("Addition",{attrs:{oper:{text:"+"}}},{arithop:(t,e)=>t+e}),Xt=v,qt=Gt.define("Subtraction",{attrs:{oper:{text:"-"}}},{arithop:(t,e)=>t-e}),$t=v,Yt=Gt.define("Multiplication",{attrs:{oper:{text:"×"}}},{arithop:(t,e)=>t*e}),Qt=v,Zt=Gt.define("Division",{attrs:{oper:{text:"÷"}}},{arithop:(t,e)=>0n==e?t:t/e}),Jt=v,Kt=Gt.define("Modulo",{attrs:{oper:{text:"%"}}},{arithop:(t,e)=>0n==e?t:t%e}),te=v,ee=Gt.define("Power",{attrs:{oper:{text:"^"}}},{arithop:(t,e)=>e>=0n?t**e:1n==t?1n:-1n==t?e%2n?-1n:1n:0n}),ie=v,se=Tt.define("ShiftLeft",{attrs:{oper:{text:"≪"}}},{shiftdir:-1}),oe=v,re=Tt.define("ShiftRight",{attrs:{oper:{text:"≫"}}},{shiftdir:1}),ne=v,ae=Et.define("Lt",{attrs:{oper:{text:"<"}}},{arithcomp:(t,e)=>t<e}),pe=v,le=Et.define("Le",{attrs:{oper:{text:"≤"}}},{arithcomp:(t,e)=>t<=e}),he=v,ce=Et.define("Gt",{attrs:{oper:{text:">"}}},{arithcomp:(t,e)=>t>e}),ue=v,de=Et.define("Ge",{attrs:{oper:{text:"≥"}}},{arithcomp:(t,e)=>t>=e}),ge=v,me=Rt.define("Eq",{attrs:{oper:{text:"="}}},{bincomp:(t,e)=>t.xnor(e).reduceAnd()}),_e=v,fe=Rt.define("Ne",{attrs:{oper:{text:"≠"}}},{bincomp:(t,e)=>t.xor(e).reduceOr()}),be=v,ye=Mt.define("OpConst",{leftOp:!1,constant:0},{initialize(){Mt.prototype.initialize.apply(this,arguments);let t=this.get("constant");("string"==typeof t||t instanceof String)&&(t=BigInt(t),Ot(t)&&(t=Number(t)),this.set("constant",t));const e=()=>{const t=30+10*String(this.get("constant")).length;this.prop("size",{width:t,height:t}),this.attr("oper/text",this.get("leftOp")?this.get("constant")+this.operSymbol:this.operSymbol+this.get("constant"))};e(),this.on("change:bits",((t,e)=>{this._setPortsBits(e)})),this.on("change:constant",(()=>e())),this.on("change:leftOp",(()=>e()))},getGateParams(){const t=Mt.prototype.getGateParams.apply(this,arguments);return"bigint"==typeof t.constant&&(Ot(t.constant)?t.constant=Number(t.constant):t.constant=String(t.constant)),t},_gateParams:Mt.prototype._gateParams.concat(["leftOp","constant"])}),xe=ye.define("ArithConst",{bits:{in:1,out:1},signed:!1},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.in},{id:"out",group:"out",dir:"out",bits:t.out}],ye.prototype.initialize.apply(this,arguments)},operation(t){const e=this.get("bits"),i=this.get("signed"),s=this.get("constant");return t.in.isFullyDefined?this.get("leftOp")?{out:u.Vector3vl.fromNumber(this.arithop(BigInt(s),t.in.toBigInt(i.in)),e.out)}:{out:u.Vector3vl.fromNumber(this.arithop(t.in.toBigInt(i.in),BigInt(s)),e.out)}:{out:u.Vector3vl.xes(e.out)}},_operationHelpers:ye.prototype._operationHelpers.concat(["arithop"])}),ve=ye.define("ShiftConst",{bits:{in:1,out:1},signed:{in:!1,out:!1},fillx:!1},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.in},{id:"out",group:"out",dir:"out",bits:t.out}],ye.prototype.initialize.apply(this,arguments)},operation(t){const e=this.get("bits"),i=this.get("signed"),s=this.get("fillx"),o=this.get("constant");if(this.get("leftOp")){if(!t.in.isFullyDefined)return{out:u.Vector3vl.xes(e.out)};const r=t.in.toNumber(i.in),n=u.Vector3vl.fromNumber(o);return{out:Lt(n,r*this.shiftdir,n.bits,e.out,o<0,i.out,s)}}return console.assert(Ot(o)),{out:Lt(t.in,Number(o)*this.shiftdir,e.in,e.out,i.in,i.out,s)}},_gateParams:ye.prototype._gateParams.concat(["fillx"]),_operationHelpers:ye.prototype._operationHelpers.concat(["shiftdir"])}),ke=ye.define("BaseCompareConst",{bits:{in:1},signed:!1},{initialize(){const t=this.get("bits");this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.in},{id:"out",group:"out",dir:"out",bits:1}],ye.prototype.initialize.apply(this,arguments)}}),we=ke.define("CompareConst",{},{operation(t){this.get("bits");const e=this.get("signed"),i=this.get("constant");return t.in.isFullyDefined?this.get("leftOp")?{out:u.Vector3vl.fromBool(this.arithcomp(BigInt(i),t.in.toBigInt(e.in)))}:{out:u.Vector3vl.fromBool(this.arithcomp(t.in.toBigInt(e.in),BigInt(i)))}:{out:u.Vector3vl.x}},_operationHelpers:ke.prototype._operationHelpers.concat(["arithcomp"])}),Se=ke.define("EqCompareConst",{},{operation(t){const e=this.get("bits"),i=(this.get("signed"),this.get("constant"));return this.get("leftOp")?{out:this.bincomp(u.Vector3vl.fromNumber(i,e.in),t.in)}:{out:this.bincomp(t.in,u.Vector3vl.fromNumber(i,e.in))}},_operationHelpers:ke.prototype._operationHelpers.concat(["bincomp"])}),Pe=xe.define("AdditionConst",{},{operSymbol:"+",arithop:(t,e)=>t+e}),Ne=v,Ce=xe.define("SubtractionConst",{},{operSymbol:"-",arithop:(t,e)=>t-e}),Ve=v,Be=xe.define("MultiplicationConst",{},{operSymbol:"×",arithop:(t,e)=>t*e}),ze=v,Ae=xe.define("DivisionConst",{},{operSymbol:"÷",arithop:(t,e)=>0n==e?t:t/e}),Oe=v,Me=xe.define("ModuloConst",{},{operSymbol:"%",arithop:(t,e)=>0n==e?t:t%e}),Ie=v,Ge=xe.define("PowerConst",{},{operSymbol:"^",arithop:(t,e)=>e>=0n?t**e:1n==t?1n:-1n==t?e%2n?-1n:1n:0n}),Le=v,Te=ve.define("ShiftLeftConst",{},{operSymbol:"≪",shiftdir:-1}),je=v,Ee=ve.define("ShiftRightConst",{},{operSymbol:"≫",shiftdir:1}),Re=v,Ue=we.define("LtConst",{},{operSymbol:"<",arithcomp:(t,e)=>t<e}),De=v,Fe=we.define("LeConst",{},{operSymbol:"≤",arithcomp:(t,e)=>t<=e}),He=v,We=we.define("GtConst",{},{operSymbol:">",arithcomp:(t,e)=>t>e}),Xe=v,qe=we.define("GeConst",{},{operSymbol:"≥",arithcomp:(t,e)=>t>=e}),$e=v,Ye=Se.define("EqConst",{},{operSymbol:"=",bincomp:(t,e)=>t.xnor(e).reduceAnd()}),Qe=v,Ze=Se.define("NeConst",{},{operSymbol:"≠",bincomp:(t,e)=>t.xor(e).reduceOr()}),Je=v,Ke=S.define("BitExtend",{extend:{input:1,output:1},propagation:0,attrs:{value:{refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle"}}},{initialize(){const t=this.get("extend");console.assert(t.input<=t.output),this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.input},{id:"out",group:"out",dir:"out",bits:t.output}],S.prototype.initialize.apply(this,arguments),this.on("change:extend",((t,e)=>{this._setPortsBits({in:e.input,out:e.output})}))},operation(t){const e=this.get("extend");return{out:t.in.concat(u.Vector3vl.make(e.output-e.input,this._extBit(t.in)))}},markup:S.prototype.markup.concat([{tagName:"text",className:"value",selector:"value"}]),_gateParams:S.prototype._gateParams.concat(["extend"]),_operationHelpers:S.prototype._operationHelpers.concat(["_extBit"])}),ti=P.extend({_autoResizeBox:!0,_calculateBoxWidth(){return this.el.querySelector("text.value").getBBox().width+10}}),ei=Ke.define("ZeroExtend",{attrs:{value:{text:"zero-extend"}}},{_extBit:t=>-1}),ii=ti,si=Ke.define("SignExtend",{attrs:{value:{text:"sign-extend"}}},{_extBit:t=>t.get(t.bits-1)}),oi=ti,ri=S.define("BusSlice",{slice:{first:0,count:1,total:2},propagation:0,size:{width:40,height:24}},{initialize(){const t=this.get("slice"),e=1==t.count?t.first:t.first+"-"+(t.first+t.count-1);this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.total},{id:"out",group:"out",dir:"out",bits:t.count,portlabel:e,labelled:!0}],S.prototype.initialize.apply(this,arguments),this.on("change:slice",((t,e)=>{this._setPortsBits({in:e.total,out:e.count})}))},operation(t){const e=this.get("slice");return{out:t.in.slice(e.first,e.first+e.count)}},_gateParams:S.prototype._gateParams.concat(["slice"])}),ni=P.extend({_autoResizeBox:!0}),ai=S.define("BusRegroup",{groups:[1],propagation:0,size:{width:40,height:void 0}},{initialize(){var t=0;const e=[],i=this.get("groups");this.get("size").height=16*i.length+8;for(const[s,o]of i.entries()){const i=t+(o>1?"-"+(t+o-1):"");t+=o,e.push({id:this.group_dir+s,group:this.group_dir,dir:this.group_dir,bits:o,portlabel:i,labelled:!0})}this.set("bits",t);const s="out"==this.group_dir?"in":"out";e.push({id:s,group:s,dir:s,bits:t}),this.get("ports").items=e,S.prototype.initialize.apply(this,arguments)},_gateParams:S.prototype._gateParams.concat(["groups"]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["groups"])}),pi=P.extend({_autoResizeBox:!0}),li=ai.define("BusGroup",{},{group_dir:"in",operation(t){const e=[];for(const i of this.get("groups").keys())e.push(t["in"+i]);return{out:u.Vector3vl.concat(...e)}}}),hi=pi,ci=ai.define("BusUngroup",{},{group_dir:"out",operation(t){const e={};let i=0;for(const[s,o]of this.get("groups").entries())e["out"+s]=t.in.slice(i,i+o),i+=o;return e}}),ui=pi;var di=i(43812);const gi=S.define("Subcircuit",{propagation:0,warning:!1,attrs:{wrapper:{refWidth:1,refHeight:1,stroke:"red",strokeWidth:10},type:{refX:.5,refY:-10,textAnchor:"middle",textVerticalAnchor:"middle"}}},{initialize(){this.bindAttrToProp("text.type/text","celltype");const t=this.get("graph");console.assert(t instanceof di.k),t.set("subcircuit",this);const e=t.getCells().filter((t=>t instanceof B)),i=e.filter((t=>t instanceof A)),s=e.filter((t=>t instanceof T));function o(t,e){return t.has("order")||e.has("order")?t.get("order")-e.get("order"):t.get("net").localeCompare(e.get("net"))}i.sort(o),s.sort(o);const r={width:80,height:16*Math.max(i.length,s.length)+8},n=[],a={};for(const[t,e]of i.entries())n.push({id:e.get("net"),group:"in",dir:"in",bits:e.get("bits"),labelled:!0});for(const[t,e]of s.entries())n.push({id:e.get("net"),group:"out",dir:"out",bits:e.get("bits"),labelled:!0});for(const t of e)a[t.get("net")]=t.get("id");this.set("size",r),this.set("circuitIOmap",a),this.get("ports").items=n,this.set("warning",t._warnings>0),S.prototype.initialize.apply(this,arguments)},_resetPortValue(t){const e=this.get("circuitIOmap"),i=this.get("graph");return"in"==t.dir?i.getCell(e[t.id]).get("outputSignals").out:"out"==t.dir?i.getCell(e[t.id]).get("inputSignals").in:S.prototype._resetPortValue.call(this,t)},getLayoutSize(){const t=this.size();return t.height+=10,t},setLayoutPosition(t){this.set("position",{x:t.x,y:t.y+10})},getPortsPositions(){const t=S.prototype.getPortsPositions.apply(this,arguments),e={};for(const i in t)e[i]={...t[i]},e[i].y=e[i].y+10;return e},markup:[{tagName:"rect",selector:"wrapper"}].concat(S.prototype.markup,[{tagName:"text",className:"type",selector:"type"}],S.prototype.markupZoom),_gateParams:S.prototype._gateParams.concat(["celltype"]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["celltype"])}),mi=P.extend({attrs:c.merge({},P.prototype.attrs,{warning:{warn:{wrapper:{"stroke-opacity":"0.5"}},none:{wrapper:{"stroke-opacity":"0"}}}}),_autoResizeBox:!0,presentationAttributes:P.addPresentationAttributes({warning:"WARNING"}),confirmUpdate(t){P.prototype.confirmUpdate.apply(this,arguments),this.hasFlag(t,"WARNING")&&this._updateWarning()},_updateWarning(){const t=this.model.get("warning"),e=this.attrs.warning[t?"warn":"none"];this._applyAttrs(e)},update(){P.prototype.update.apply(this,arguments),this._updateWarning()},events:{"click foreignObject.tooltip":"stopprop","mousedown foreignObject.tooltip":"stopprop","touchstart foreignObject.tooltip":"stopprop","click a.zoom":"zoomInCircuit"},zoomInCircuit(t){return t.stopPropagation(),this.paper.trigger("open:subcircuit",this.model),!1}}),_i=x.define("GenMux",{bits:{in:1,sel:1},size:{width:40,height:void 0},ports:{groups:{in2:{position:{name:"top",args:{y:5}},attrs:c.merge({},y,{wire:{x2:0,y2:-25},port:{magnet:"passive",refY:-25},bits:{refDx:-5,refDy:2,textAnchor:"start"}}),z:-1}}},attrs:{label:{refDy:8}}},{initialize(){const t=this.get("bits"),e=[{id:"sel",group:"in2",dir:"in",bits:t.sel},{id:"out",group:"out",dir:"out",bits:t.in}],i=this.muxInputs(t.sel);this.get("size").height=16*i.length+8;const s="M"+[[2,0],[5,5],[10,-5]].map((t=>t.join(" "))).join(" L");for(const[o,r]of i.entries()){const i={id:"in"+o,group:"in",dir:"in",bits:t.in,decor:s};r&&(i.portlabel=String(r),i.labelled=!0),e.push(i)}this.get("ports").items=e,x.prototype.initialize.apply(this,arguments);const o=t=>this.attr(["body","points"],[[0,-5],[t.width,5],[t.width,t.height-5],[0,t.height+5]].map((t=>t.join(","))).join(" "));o(this.get("size")),this.on("change:size",((t,e)=>o(e)))},operation(t){const e=this.muxInput(t.sel);return void 0===e?{out:u.Vector3vl.xes(this.get("bits").in)}:{out:t["in"+e]}},getLayoutSize(){const t=this.size();return t.height+=30,t},setLayoutPosition(t){this.set("position",{x:t.x,y:t.y+20})},getPortsPositions(){const t=x.prototype.getPortsPositions.apply(this,arguments),e={};for(const i in t)e[i]={...t[i]},e[i].y=e[i].y+20;return e},markup:x.prototype.markup.concat([{tagName:"polygon",className:"body",selector:"body"}]),_gateParams:x.prototype._gateParams.concat(["bits"]),_unsupportedPropChanges:x.prototype._unsupportedPropChanges.concat(["bits"]),_operationHelpers:x.prototype._operationHelpers.concat(["muxInput"])}),fi=v.extend({initialize(){this.ins=this.model.muxInputs(this.model.get("bits").sel),v.prototype.initialize.apply(this,arguments)},confirmUpdate(t){v.prototype.confirmUpdate.apply(this,arguments),this.hasFlag(t,"SIGNAL")&&this._updateMux(this.model.get("inputSignals"))},render(){v.prototype.render.apply(this,arguments),this._updateMux(this.model.get("inputSignals"))},_updateMux(t){const e=this.model.muxInput(t.sel);for(const t of this.ins.keys())this.$("[port=in"+t+"] path.decor").css("visibility",e==t?"visible":"hidden")}}),bi=_i.define("Mux",{},{muxInputs:t=>Array(1<<t),muxInput:t=>t.isFullyDefined?t.toBigInt().toString():void 0}),yi=fi,xi=_i.define("Mux1Hot",{attrs:{info:{refX:.5,refY:.5,textAnchor:"middle",textVerticalAnchor:"middle",text:"1Hot",transform:"rotate(90)"}}},{markup:_i.prototype.markup.concat([{tagName:"text",className:"info",selector:"info"}]),muxInputs:t=>Array(t+1),muxInput:t=>{const e=t.toArray();return t.isFullyDefined&&e.filter((t=>1==t)).length<=1?String(e.indexOf(1)+1):void 0}}),vi=fi,ki=_i.define("MuxSparse",{inputs:void 0,default_input:!1},{initialize(){const t=this.get("inputs");for(let e=0;e<t.length;e++)"bigint"!=typeof t[e]&&(t[e]=BigInt(t[e]));_i.prototype.initialize.apply(this,arguments)},muxInputs(t){return this.get("default_input")?["*"].concat(this.get("inputs")):this.get("inputs")},muxInput(t){const e=this.get("default_input");if(!t.isFullyDefined)return;const i=this.get("inputs").indexOf(t.toBigInt());return i<0?e?0:void 0:e?i+1:i},_gateParams:_i.prototype._gateParams.concat(["inputs","default_input"]),_unsupportedPropChanges:_i.prototype._unsupportedPropChanges.concat(["inputs","default_input"])}),wi=fi,Si=S.define("Dff",{bits:1,initial:"x",size:{width:80,height:void 0},ports:{groups:{in:{position:S.prototype._getStackedPosition({side:"left"})},out:{position:S.prototype._getStackedPosition({side:"right"})}}}},{initialize(){const t=this.get("bits"),e=(this.get("initial"),this.get("polarity")||{}),i=[];this.get("no_data")||i.push({id:"in",group:"in",dir:"in",bits:t,portlabel:"D",labelled:!0}),i.push({id:"out",group:"out",dir:"out",bits:t,portlabel:"Q",labelled:!0}),"arst"in e&&!this.get("arst_value")&&this.set("arst_value",Array(t).fill("0").join("")),"srst"in e&&!this.get("srst_value")&&this.set("srst_value",Array(t).fill("0").join(""));let s=1;"aload"in e&&(s+=2,i.push({id:"ain",group:"in",dir:"in",bits:t,portlabel:"AD",labelled:!0}),i.push({id:"aload",group:"in",dir:"in",bits:1,polarity:e.aload,labelled:!0})),"clock"in e&&(s++,i.push({id:"clk",group:"in",dir:"in",bits:1,polarity:e.clock,decor:S.prototype.decorClock,labelled:!0})),"set"in e&&(s++,i.push({id:"set",group:"in",dir:"in",bits:t,polarity:e.set,portlabel:"S",labelled:!0})),"clr"in e&&(s++,i.push({id:"clr",group:"in",dir:"in",bits:t,polarity:e.clr,portlabel:"R",labelled:!0})),"srst"in e&&(s++,i.push({id:"srst",group:"in",dir:"in",bits:1,polarity:e.srst,labelled:!0})),"arst"in e&&(s++,i.push({id:"arst",group:"in",dir:"in",bits:1,polarity:e.arst,labelled:!0})),"enable"in e&&(s++,i.push({id:"en",group:"in",dir:"in",bits:1,polarity:e.enable,labelled:!0})),this.get("size").height=16*s+8,this.get("ports").items=i,this.last_clk=0,S.prototype.initialize.apply(this,arguments)},_resetPortValue(t){return"out"==t.id&&"out"==t.dir?u.Vector3vl.fromBin(this.get("initial"),t.bits):S.prototype._resetPortValue.call(this,t)},operation(t){const e=this.get("polarity"),i=t=>e[t]?1:-1;let s,o,r;const n=t=>({out:o?t.and(r).or(o):t});if("clock"in e&&(s=this.last_clk,this.last_clk=t.clk.get(0)),"arst"in e&&t.arst.get(0)==i("arst"))return{out:u.Vector3vl.fromBin(this.get("arst_value"),this.get("bits"))};if("aload"in e&&t.aload.get(0)==i("aload"))return{out:t.ain};if("set"in e&&(o=e.set?t.set:t.set.not(),r=e.set?t.set.not():t.set),"clr"in e){o=o||u.Vector3vl.zeros(this.get("bits"));const i=e.clr?t.clr.not():t.clr;r=r?i.and(r):i}return"enable"in e&&t.en.get(0)!=i("enable")&&this.get("enable_srst")?n(this.get("outputSignals").out):!("clock"in e)||t.clk.get(0)==i("clock")&&s==-i("clock")?"srst"in e&&t.srst.get(0)==i("srst")?n(u.Vector3vl.fromBin(this.get("srst_value"),this.get("bits"))):"enable"in e&&t.en.get(0)!=i("enable")&&!this.get("enable_srst")||this.get("no_data")?n(this.get("outputSignals").out):n(t.in):n(this.get("outputSignals").out)},_gateParams:S.prototype._gateParams.concat(["polarity","bits","initial","arst_value","srst_value","enable_srst","no_data"]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["polarity","bits","initial","arst_value","srst_value","enable_srst","no_data"])}),Pi=P.extend({_autoResizeBox:!0}),Ni=S.define("Memory",{bits:1,abits:1,rdports:[],wrports:[],words:void 0,offset:0,attrs:{portsplit:{stroke:"black"}},ports:{groups:{in:{position:S.prototype._getStackedPosition({side:"left"})},out:{position:S.prototype._getStackedPosition({side:"right"})}}}},{initialize(){const t=this.get("bits"),e=this.get("abits");this.get("rdports"),this.get("wrports");let i=0,s=0;const o=[],r=[];for(const[n,a]of this._memrdports())o.push({id:n+"addr",group:"in",dir:"in",bits:e,portlabel:"addr",labelled:!0},{id:n+"data",group:"out",dir:"out",bits:t,portlabel:"data",labelled:!0,args:{idxOffset:s}}),i+=1,"srst_polarity"in a&&(i++,s++,o.push({id:n+"srst",group:"in",dir:"in",bits:1,portlabel:"srst",polarity:a.srst_polarity,labelled:!0})),"arst_polarity"in a&&(i++,s++,o.push({id:n+"arst",group:"in",dir:"in",bits:1,portlabel:"arst",polarity:a.arst_polarity,labelled:!0})),"enable_polarity"in a&&(i++,s++,o.push({id:n+"en",group:"in",dir:"in",bits:1,portlabel:"en",polarity:a.enable_polarity,labelled:!0})),"clock_polarity"in a&&(i++,s++,o.push({id:n+"clk",group:"in",dir:"in",bits:1,portlabel:"clk",polarity:a.clock_polarity,decor:S.prototype.decorClock,labelled:!0})),r.push(i);for(const[s,n]of this._memwrports())i+=2,o.push({id:s+"data",group:"in",dir:"in",bits:t,portlabel:"data",labelled:!0},{id:s+"addr",group:"in",dir:"in",bits:e,portlabel:"addr",labelled:!0}),"enable_polarity"in n&&(i++,o.push({id:s+"en",group:"in",dir:"in",bits:n.no_bit_enable?1:t,portlabel:"en",polarity:n.enable_polarity,labelled:!0})),"clock_polarity"in n&&(i++,o.push({id:s+"clk",group:"in",dir:"in",bits:1,portlabel:"clk",polarity:n.clock_polarity,decor:S.prototype.decorClock,labelled:!0})),r.push(i);r.pop(),this.get("size").height=16*i+8,this.get("ports").items=o,S.prototype.initialize.apply(this,arguments),this.removeProp("memdata"),this.on("change:size",((t,e)=>{const i=[];for(const t of r)i.push([[0,16*t+4],[e.width,16*t+4]].map((t=>t.join(" "))).join(" L "));this.attr("path.portsplit/d","M "+i.join(" M "))}))},_resetPortValue(t){if("out"==t.dir){const e=/^rd([0-9]+)data$/.exec(t.id),i=e?this.get("rdports")[e[1]]:{};if("init_value"in i)return u.Vector3vl.fromBin(i.init_value,t.bits)}return S.prototype._resetPortValue.call(this,t)},prepare(){const t=this.get("bits");var e=this.get("words");const i=this.get("memdata");e||(e=1<<abits,this.prop("words",e,{init:!0})),this.memdata=i?u.Mem3vl.fromJSON(t,i):new u.Mem3vl(t,e),console.assert(this.memdata.words==e),this.last_clk={};for(const[t,e]of this._memports())"clock_polarity"in e&&(this.last_clk[t+"clk"]=0)},operation(t){const e=this.get("bits"),i={},s=(t,e)=>t[e+"_polarity"]?1:-1,o=(e,i)=>!("enable_polarity"in i&&!t[e+"en"].toArray().some((t=>t==s(i,"enable")))),r=(e,i)=>{const o=e+"clk";return!("clock_polarity"in i)||t[o].get(0)==s(i,"clock")&&this.last_clk[o]==-s(i,"clock")},n=t=>t>=0&&t<this.get("words"),a=(s,o)=>{const r=this._calcaddr(t[s+"addr"]);n(r)?i[s+"data"]=this.memdata.get(r):i[s+"data"]=u.Vector3vl.xes(e)},p=(e,i,s,o)=>{if(i.no_bit_enable||!("enable_polarity"in i))return o;const r=i.enable_polarity?t[e+"en"]:t[e+"en"].not();return o.and(r).or(s.and(r.not()))},l=(s,o)=>{a(s);for(const[n,a]of this.get("wrports").entries()){const l="wr"+n,h=(t,e)=>"boolean"==typeof t?t:t[e];"transparent"in o&&h(o.transparent,n)&&r(l,a)&&t[s+"addr"]==t[l+"addr"]&&(i[s+"data"]=p(l,a,i[s+"data"],t[l+"data"])),"collision"in o&&h(o.collision,n)&&r(l,a)&&t[s+"addr"]==t[l+"addr"]&&(i[s+"data"]=p(l,a,i[s+"data"],u.Vector3vl.xes(e)))}},h=(e,i)=>{const s=this._calcaddr(t[e+"addr"]);if(n(s)){const o=this.memdata.get(s),r=p(e,i,o,t[e+"data"]),n=!o.eq(r);this.memdata.set(s,r),n&&this.trigger("memChange",s,r)}},c=(o,r)=>{t[o+"srst"].get(0)==s(r,"srst")&&(i[o+"data"]="srst_value"in r?u.Vector3vl.fromBin(r.srst_value,e):u.Vector3vl.zeros(e))},d=(o,r)=>{t[o+"arst"].get(0)==s(r,"arst")&&(i[o+"data"]="arst_value"in r?u.Vector3vl.fromBin(r.arst_value,e):u.Vector3vl.zeros(e))},g=(e,i)=>{if("clock_polarity"in i){const i=e+"clk";this.last_clk[i]=t[i].get(0)}};for(const[t,e]of this._memrdports())i[t+"data"]=this.get("outputSignals")[t+"data"],"clock_polarity"in e&&o(t,e)&&r(t,e)&&l(t,e);for(const[t,e]of this._memwrports())o(t,e)&&r(t,e)&&h(t,e);for(const[t,e]of this._memrdports())!("clock_polarity"in e)&&o(t,e)&&a(t);for(const[t,e]of this._memrdports())"srst_polarity"in e&&(o(t,e)||!("enable_srst"in e))&&r(t,e)&&c(t,e),"arst_polarity"in e&&d(t,e);for(const[t,e]of this._memrdports())g(t,e);for(const[t,e]of this._memwrports())g(t,e);return i},_calcaddr(t){return t.isFullyDefined?t.toNumber()-this.get("offset"):-1},*_memrdports(){for(const[t,e]of this.get("rdports").entries())yield["rd"+t,e]},*_memwrports(){for(const[t,e]of this.get("wrports").entries())yield["wr"+t,e]},*_memports(){yield*this._memrdports(),yield*this._memwrports()},markup:S.prototype.markup.concat([{tagName:"path",className:"portsplit",selector:"portsplit"}],S.prototype.markupZoom),getGateParams(){const t=S.prototype.getGateParams.apply(this,arguments);return t.memdata=this.memdata.toJSON(),t},_gateParams:S.prototype._gateParams.concat(["bits","abits","rdports","wrports","words","offset"]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["bits","abits","rdports","wrports","words","offset"]),_operationHelpers:S.prototype._operationHelpers.concat(["_memrdports","_memwrports","_memports","_calcaddr"])}),Ci=P.extend({_autoResizeBox:!0,events:{"click foreignObject.tooltip":"stopprop","mousedown foreignObject.tooltip":"stopprop","touchstart foreignObject.tooltip":"stopprop","click a.zoom":"_displayEditor"},_displayEditor(t){t.stopPropagation();const e=this.model.graph._display3vl,i=N("<div>",{title:"Memory contents: "+this.model.get("label")}).appendTo("html > body");i.append(N('<div class="btn-toolbar" role="toolbar"><div class="btn-group mr-2" role="group"><button name="prev" type="button" class="btn btn-secondary" title="Previous page">←</button><button name="next" type="button" class="btn btn-secondary" title="Next page">→</button></div><div class="input-group">'+function(t,e,i){return'<select name="base">'+t.usableDisplays("read",e).map((t=>'<option value="'+t+'"'+("hex"==t?' selected="selected"':"")+">"+t+"</option>")).join("")+"</select>"}(e,this.model.get("bits"))+'</div></div><table class="memeditor"></table>'));const s=this.model.get("words"),o=this.model.memdata,r=Math.ceil(this.model.get("abits")/4);let n,a=0;const p=()=>i.find("select[name=base]").val(),l=t=>{const e=Math.floor((t-a)/n),s=t-a-e*n;return i.find("table tr:nth-child("+(e+1)+") td:nth-child("+(s+2)+") input")},h=t=>{for(const[e,i]of this.model._memrdports())l(this.model._calcaddr(t[e+"addr"])).removeClass("isread");for(const[e,i]of this.model._memwrports())l(this.model._calcaddr(t[e+"addr"])).removeClass("iswrite")},c=t=>{for(const[e,i]of this.model._memrdports())l(this.model._calcaddr(t[e+"addr"])).addClass("isread");for(const[e,i]of this.model._memwrports())l(this.model._calcaddr(t[e+"addr"])).addClass("iswrite")},u=()=>{const t=p();i.find("button[name=prev]").prop("disabled",a<=0),i.find("button[name=next]").prop("disabled",a+8*n>=s);let o=i.find("table tr:first-child");const l=this.model.memdata;for(let i=0;i<8&&!(a+i*n>=s);i++,o=o.next()){const p=(a+i*n).toString(16);let h=o.find("td:first-child");h.text("0".repeat(r-p.length)+p),h=h.next();for(let o=0;o<n&&!(a+i*n+o>=s);o++,h=h.next())h.find("input").val(e.show(t,l.get(a+i*n+o))).removeClass("invalid")}c(this.model.get("inputSignals"))},d=()=>{const t=p(),o=e.pattern(t),r=e.size(t,this.model.get("bits"));n=Math.min(s,16,Math.ceil(32/r)),a=Math.max(0,Math.min(s-8*n,a));const l=i.find("table");l.empty();for(let t=0;t<8&&!(a+t*n>=s);t++){const e=N("<tr>");N("<td>").appendTo(e);for(let i=0;i<n&&!(a+t*n+i>=s);i++){const t=N("<td>");N('<input type="text">').attr("size",r).attr("maxlength",r).attr("pattern",o).appendTo(t),t.appendTo(e)}e.appendTo(l)}u()};return d(),i.find("select[name=base]").on("change",d),i.find("button[name=prev]").on("click",(()=>{h(this.model.get("inputSignals")),a=Math.max(0,a-8*n),u()})),i.find("button[name=next]").on("click",(()=>{h(this.model.get("inputSignals")),a=Math.min(s-8*n,a+8*n),u()})),i.on("change","input",(t=>{const i=p(),s=N(t.target),r=s.closest("td").index()-1,l=s.closest("tr").index(),h=a+l*n+r,c=this.model.get("bits");if(e.validate(i,t.target.value,c)){const r=e.read(i,t.target.value,c);o.set(h,r),this.model.trigger("manualMemChange",this.model,h,r),s.removeClass("invalid")}else s.addClass("invalid")})),this.listenTo(this.model,"memChange",((t,i)=>{if(t<a||t>a+8*n)return;const s=p(),r=l(t).val(e.show(s,o.get(t))).removeClass("invalid").removeClass("flash");setTimeout((()=>{r.addClass("flash")}),10)})),this.listenTo(this.model,"change:inputSignals",((t,e)=>{h(this.model.previous("inputSignals")),c(e)})),this.paper.trigger("open:memorycontent",i,(()=>{i.remove(),this.stopListening()})),!1}});var Vi=i(6866),Bi=i(85678),zi=i(70681),Ai=i(28282);const Oi=S.define("FSM",{bits:{in:1,out:1},polarity:{clock:!0},init_state:0,states:1,trans_table:[],size:{width:80,height:56},ports:{groups:{in:{position:S.prototype._getStackedPosition({side:"left"})},out:{position:S.prototype._getStackedPosition({side:"right"})}}}},{initialize(){const t=this.get("bits"),e=this.get("polarity"),i=this.get("init_state"),s=this.get("states");this.get("trans_table"),this.get("ports").items=[{id:"in",group:"in",dir:"in",bits:t.in,labelled:!0},{id:"clk",group:"in",dir:"in",bits:1,polarity:e.clock,decor:S.prototype.decorClock,labelled:!0},{id:"arst",group:"in",dir:"in",bits:1,polarity:e.arst,labelled:!0},{id:"out",group:"out",dir:"out",bits:t.out,labelled:!0}],S.prototype.initialize.apply(this,arguments);const o=this.get("current_state");this.fsmgraph=new di.k;const r=[];for(let t=0;t<s;t++){const e=new n.Cd({stateNo:t,id:"state"+t,isInit:t==i});e.attr("label/text",String(t)),e.resize(100,50),t==i&&e.attr("body/strokeWidth",3),t==o&&e.attr("body/class","current_state"),e.addTo(this.fsmgraph),r.push(e)}for(const[t,e]of this.transitions)for(const i of e){const e=new n.rU({id:i.id,ctrlIn:i.ctrlIn,ctrlOut:i.ctrlOut});e.appendLabel({attrs:{text:{text:e.get("ctrlIn").toBin()+"/"+e.get("ctrlOut").toBin()}}}),e.source({id:"state"+t}),e.target({id:"state"+i.stateOut}),e.addTo(this.fsmgraph)}this.listenTo(this,"change:current_state",((t,e)=>{const i=t.previous("current_state");this.fsmgraph.getCell("state"+i).removeAttr("body/class"),this.fsmgraph.getCell("state"+e).attr("body/class","current_state")})),this.listenTo(this,"change:next_trans",((t,e)=>{const i=t.previous("next_trans");if(i){const t=this.fsmgraph.getCell(i);t.removeAttr("line/class"),t.removeAttr("line/targetMarker/class")}e&&this.fsmgraph.getCell(e).attr({line:{class:"next_trans",targetMarker:{class:"next_trans"}}})}))},prepare(){const t=this.get("bits");this.transitions=new Map;var e=0;for(const i of this.get("trans_table"))this.transitions.has(i.state_in)||this.transitions.set(i.state_in,[]),this.transitions.get(i.state_in).push({id:"tr"+e,stateOut:i.state_out,ctrlIn:u.Vector3vl.fromBin(i.ctrl_in,t.in),ctrlOut:u.Vector3vl.fromBin(i.ctrl_out,t.out)}),e++;var i=this.get("current_state");void 0===i&&(i=this.get("init_state"),this.set("current_state",i)),this.last_clk=0},operation(t){const e=this.get("bits"),i=this.get("polarity"),s=()=>{const e=this.transitions.get(this.get("current_state"))||[];for(const i of e){const e=i.ctrlIn,s=e.xmask();if(t.in.or(s).eq(e.or(s)))return i}},o=t=>i[t]?1:-1;if(t.arst.get(0)==o("arst"))this.set("current_state",this.get("init_state"));else{const e=this.last_clk;if(t.clk.get(0)==o("clock")&&e==-o("clock")){const t=s();this.set("current_state",t?t.stateOut:this.get("init_state"))}}this.last_clk=t.clk.get(0);const r=s();return r?this.set("next_trans",r.id):this.set("next_trans",void 0),{out:(()=>{const i=this.transitions.get(this.get("current_state"))||[],s=t.in.xmask(),o=[];for(const e of i){const i=e.ctrlIn,r=i.xmask().or(s);t.in.or(r).eq(i.or(r))&&o.push(e.ctrlOut)}const r=u.Vector3vl.xes(e.out);if(0==o.length)return r;for(;o.length>1;){const t=o.pop(),e=o[0].xnor(t).or(r);o[0]=o[0].and(e).or(r.and(e.xmask()))}return o[0]})()}},markup:S.prototype.markup.concat(S.prototype.markupZoom),_gateParams:S.prototype._gateParams.concat(["bits","polarity","states","init_state","trans_table"]),_unsupportedPropChanges:S.prototype._unsupportedPropChanges.concat(["bits","polarity","states","init_state","trans_table"]),_presentationParams:S.prototype._presentationParams.concat(["current_state","next_trans"])}),Mi=P.extend({_autoResizeBox:!0,events:{"click foreignObject.tooltip":"stopprop","mousedown foreignObject.tooltip":"stopprop","touchstart foreignObject.tooltip":"stopprop","click a.zoom":"_displayEditor"},_displayEditor(t){t.stopPropagation();const e=N("<div>",{title:"FSM: "+this.model.get("label")}).appendTo("html > body"),i=N("<div>").appendTo(e),s=this.model.fsmgraph,o=new Bi.X({el:i,model:s});return s.resetCells(s.getCells()),s.get("laid_out")||(Vi.S.layout(s,{dagre:zi,graphlib:Ai}),s.set("laid_out",!0)),this.listenTo(s,"change:position",(t=>{o.fitToContent({padding:30,allowNewOrigin:"any"})})),o.fitToContent({padding:30,allowNewOrigin:"any"}),this.paper.trigger("open:fsm",e,(()=>{o.remove(),e.remove()})),!1}});var Ii=i(21187);const Gi=new Set(["Subcircuit","Input","Output","Button","Lamp","NumEntry","NumDisplay"]);class Li{constructor(t,e){this.source=t,this.target=e}}class Ti{constructor(t,e,i,o,r,n){this.id=t,this.graph=e,this.special=Gi.has(i.type),this.isSubcircuit="Subcircuit"==i.type,this.isOutput="Output"==i.type;const a=s[i.type].prototype;this.operation=a.operation;for(const t of a._operationHelpers)this[t]=a[t];this.links=new Set,this._links_to=Object.create(null),this._params=i,this._params.inputSignals=Object.create(null),this._params.outputSignals=Object.create(null),this._presentationParams=a._presentationParams,this._presentationParamChanged=Object.create(null),this._monitors=Object.create(null),this._ports=Object.create(null);for(const t of o)this._ports[t.id]=t,this._monitors[t.id]=new Set,"in"==t.dir&&(this._params.inputSignals[t.id]=u.Vector3vl.fromClonable(r[t.id])),"out"==t.dir&&(this._params.outputSignals[t.id]=u.Vector3vl.fromClonable(n[t.id]),this._links_to[t.id]=new Set);a.prepare.call(this)}get(t){return this._params[t]}set(t,e){this._params[t]=e,this._presentationParams.includes(t)&&Ei._markPresentationParam(this,t)}addLinkTo(t,e){this._links_to[t].add(e)}removeLinkTo(t,e){this._links_to[t].delete(e)}addLink(t){this.links.add(t)}removeLink(t){this.links.delete(t)}targets(t){return this._links_to[t]}getPort(t){return this._ports[t]}getPorts(){return Object.values(this._ports)}trigger(t,...e){postMessage({type:"gateTrigger",args:[this.graph.id,this.id,t,e]})}monitor(t,e){this._monitors[t].add(e)}unmonitor(t,e){this._monitors[t].delete(Number(e))}getMonitors(t){return this._monitors[t]}}class ji{constructor(t){this.id=t,this._gates={},this._links={},this._observed=!1,this._subcircuit=null}addLink(t,e,i){this._links[t]=new Li(e,i),this._gates[e.id].addLinkTo(e.port,i),this._gates[e.id].addLink(t),this._gates[i.id].addLink(t)}addGate(t,e,i,s,o){this._gates[t]=new Ti(t,this,e,i,s,o)}removeLink(t){const e=this._links[t];this._gates[e.source.id].removeLinkTo(e.source.port,e.target),this._gates[e.source.id].removeLink(t),this._gates[e.target.id].removeLink(t),delete this._links[t]}removeGate(t){for(const e of this._gates[t].links)this.removeLink(e);this._gates[t].graph=null,delete this._gates[t]}getGate(t){return this._gates[t]}getLink(t){return this._links[t]}getGates(){return Object.values(this._gates)}observe(){this._observed=!0}unobserve(){this._observed=!1}get observed(){return this._observed}setSubcircuit(t){this._subcircuit=t}get subcircuit(){return this._subcircuit}}const Ei=new class{constructor(){this._interval=10,this._graphs=Object.create(null),this._monitors=Object.create(null),this._monitorChecks=Object.create(null),this._alarms=Object.create(null),this._alarmQueue=new Map,this._queue=new Map,this._pq=new Ii,this._toUpdate=new Map,this._toUpdateParam=new Map,this._tick=0,this._sender=setInterval((()=>{this._sendUpdates()}),25),this._updater=null}interval(t){this._interval=t}updateGates(t,e){const i=this._updateGates();e&&this._sendUpdates(),this._postMonitors(),this._sendAck(t,i)}_updateGates(){if(this._pq.peek()==this._tick)return this._updateGatesNext();{const t=0|this._tick;return this._tick=t+1|0,0}}updateGatesNext(t,e){const i=this._updateGatesNext();e&&this._sendUpdates(),this._postMonitors(),this._sendAck(t,i)}_updateGatesNext(){const t=0|this._pq.poll();console.assert(t>=this._tick),this._tick=t;const e=this._queue.get(t);let i=0;for(;e.size;){const[t,s]=e.entries().next().value;if(e.delete(t),t.special)continue;if(!t.graph)continue;const o=t.operation(s);"_clock_hack"in o&&(delete o._clock_hack,this._enqueue(t)),this._setGateOutputSignals(t,o),i++}return this._queue.delete(t),this._tick=t+1|0,i}ping(t,e){e&&this._sendUpdates(),this._sendAck(t)}start(){this._stop(),this._updater=setInterval((()=>{this._updateGates(),this._postMonitors()}),this._interval)}startFast(){this._stop(),this._updater=setInterval((()=>{const t=Date.now();for(;Date.now()-t<10&&this._hasPendingEvents()&&this._updater;)this._updateGatesNext(),this._postMonitors()}),10)}stop(t,e){this._stop(),e&&this._sendUpdates(),this._sendAck(t)}_stop(){this._updater&&(clearInterval(this._updater),this._updater=null)}addGraph(t){console.assert(!(t in this._graphs)),this._graphs[t]=new ji(t)}addLink(t,e,i,s){const o=this._graphs[t];o.addLink(e,i,s);const r=o.getGate(i.id),n=o.getGate(s.id),a=r.get("outputSignals")[i.port];this._setGateInputSignal(n,s.port,a)}addGate(t,e,i,s,o,r){const n=this._graphs[t];n.addGate(e,i,s,o,r),this._enqueue(n.getGate(e))}addSubcircuit(t,e,i,s){const o=this._graphs[t].getGate(e),r=this._graphs[i];o.set("subgraph",r),o.set("circuitIOmap",s),r.setSubcircuit(o);for(const[t,e]of Object.entries(s)){const i=r.getGate(e);"in"==o.getPort(t).dir&&this._setGateOutputSignal(i,"out",o.get("inputSignals")[t]),"out"==o.getPort(t).dir&&this._setGateOutputSignal(o,t,i.get("inputSignals").in)}}removeLink(t,e){const i=this._graphs[t],s=i.getLink(e);i.removeLink(e);const o=i.getGate(s.target.id),r=u.Vector3vl.xes(o.getPort(s.target.port).bits);this._setGateInputSignal(o,s.target.port,r)}removeGate(t,e){this._graphs[t].removeGate(e)}observeGraph(t){const e=this._graphs[t];e.observe();for(const t of e.getGates())for(const e of t.getPorts())"out"==e.dir&&this._markUpdate(t,e.id)}unobserveGraph(t){this._graphs[t].unobserve()}changeInput(t,e,i){const s=this._graphs[t].getGate(e);this._setGateOutputSignals(s,{out:u.Vector3vl.fromClonable(i)})}changeParam(t,e,i,s){this._graphs[t].getGate(e).set(i,s)}manualMemChange(t,e,i,s){const o=this._graphs[t].getGate(e);o.memdata.set(i,u.Vector3vl.fromClonable(s)),this._enqueue(o)}monitor(t,e,i,s,{triggerValues:o,stopOnTrigger:r,oneShot:n,synchronous:a}){if(null!=o)for(const t of o.keys())o[t]=u.Vector3vl.fromClonable(o[t]);const p=this._graphs[t].getGate(e);this._monitors[s]={gate:p,port:i,triggerValues:o,stopOnTrigger:r,oneShot:n,synchronous:a},p.monitor(i,s),null==o&&postMessage({type:"monitorValue",args:[s,this._tick,p.get("outputSignals")[i]]})}unmonitor(t){const e=this._monitors[t];null!=e&&(e.gate.unmonitor(e.port,t),delete this._monitors[t],delete this._monitorChecks[t])}alarm(t,e,{stopOnAlarm:i,synchronous:s}){t<=this._tick||(this._alarms[e]={tick:t,stopOnAlarm:i,synchronous:s},this._alarmQueue.has(t)||this._alarmQueue.set(t,new Set),this._alarmQueue.get(t).add(e),this._pq.add(t-1),this._queue.has(t-1)||this._queue.set(t-1,new Map))}unalarm(t){const e=this._alarms[t];if(null==e)return;const i=e.tick;this._alarmQueue.get(i).delete(t),0==this._alarmQueue.get(i).size&&this._alarmQueue.delete(i),delete this._alarms[t]}_enqueue(t){const e=this._tick+t.get("propagation")|0;(()=>{const t=this._queue.get(e);if(void 0!==t)return t;const i=new Map;return this._queue.set(e,i),this._pq.add(e),i})().set(t,Object.assign({},t.get("inputSignals")))}_postMonitors(){for(const[t,e]of Object.entries(this._monitorChecks)){const{triggerValues:i,stopOnTrigger:s,oneShot:o,synchronous:r}=this._monitors[t];let n=!0;i&&(n=i.some((t=>e.eq(t)))),n&&(o&&this.unmonitor(t),r&&this._sendUpdates(),postMessage({type:"monitorValue",args:[t,this._tick,e,s,o]}),s&&this._stop())}if(this._monitorChecks=Object.create(null),this._alarmQueue.get(this._tick)){for(const t of this._alarmQueue.get(this._tick)){const{stopOnAlarm:e,synchronous:i}=this._alarms[t];i&&this._sendUpdates(),delete this._alarms[t],postMessage({type:"alarmReached",args:[t,this._tick,e]}),e&&this._stop()}this._alarmQueue.delete(this._tick)}}_setGateOutputSignals(t,e){for(const[i,s]of Object.entries(e))this._setGateOutputSignal(t,i,s)}_setGateOutputSignal(t,e,i){const s=t.get("outputSignals"),o=s[e];if(i.eq(o))return;s[e]=i,this._markUpdate(t,e);for(const s of t.targets(e)){const e=t.graph.getGate(s.id);this._setGateInputSignal(e,s.port,i)}const r=t.getMonitors(e);for(const t of r)this._monitorChecks[t]=i}_setGateInputSignal(t,e,i){const s=t.get("inputSignals"),o=s[e];if(!i.eq(o))if(s[e]=i,t.isSubcircuit){const s=t.get("subgraph");if(!s)return;const o=t.get("circuitIOmap"),r=s.getGate(o[e]);if(!r)return;this._setGateOutputSignals(r,{out:i})}else if(t.isOutput){const e=t.graph.subcircuit;if(!e)return;const s=t.get("net");this._setGateOutputSignal(e,s,i)}else this._enqueue(t)}_markUpdate(t,e){t.graph.observed&&(()=>{const e=this._toUpdate.get(t);if(void 0!==e)return e;const i=new Set;return this._toUpdate.set(t,i),i})().add(e)}_markPresentationParam(t,e){t.graph.observed&&(()=>{const e=this._toUpdateParam.get(t);if(void 0!==e)return e;const i=new Set;return this._toUpdateParam.set(t,i),i})().add(e)}_sendUpdates(){const t=[];for(const[e,i]of this._toUpdate){const s=e.get("outputSignals"),o={};for(const t of i)o[t]=s[t];t.push([e.graph.id,e.id,o])}this._toUpdate=new Map;const e=this._hasPendingEvents();if(postMessage({type:"update",args:[this._tick,e,t]}),this._toUpdateParam.size>0){for(const[t,e]of this._toUpdateParam)for(const i of e)postMessage({type:"gateSet",args:[t.graph.id,t.id,i,t.get(i)]});this._toUpdateParam=new Map}}_sendAck(t,e){postMessage({type:"ack",args:[t,e]})}_hasPendingEvents(){return this._queue.size>0}};self.onmessage=t=>{const e=t.data;"arg"in e?Ei[e.type](e.arg):"args"in e?Ei[e.type].apply(Ei,e.args):Ei[e.type]()}}},s={};function o(t){var e=s[t];if(void 0!==e)return e.exports;var r=s[t]={id:t,loaded:!1,exports:{}};return i[t].call(r.exports,r,r.exports,o),r.loaded=!0,r.exports}return o.m=i,o.x=()=>{var t=o.O(void 0,[357],(()=>o(79286)));return o.O(t)},t=[],o.O=(e,i,s,r)=>{if(!i){var n=1/0;for(h=0;h<t.length;h++){for(var[i,s,r]=t[h],a=!0,p=0;p<i.length;p++)(!1&r||n>=r)&&Object.keys(o.O).every((t=>o.O[t](i[p])))?i.splice(p--,1):(a=!1,r<n&&(n=r));if(a){t.splice(h--,1);var l=s();void 0!==l&&(e=l)}}return e}r=r||0;for(var h=t.length;h>0&&t[h-1][2]>r;h--)t[h]=t[h-1];t[h]=[i,s,r]},o.d=(t,e)=>{for(var i in e)o.o(e,i)&&!o.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},o.f={},o.e=t=>Promise.all(Object.keys(o.f).reduce(((e,i)=>(o.f[i](t,e),e)),[])),o.u=t=>t+".main.js",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.nmd=t=>(t.paths=[],t.children||(t.children=[]),t),(()=>{var t;o.g.importScripts&&(t=o.g.location+"");var e=o.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");i.length&&(t=i[i.length-1].src)}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),o.p=t})(),(()=>{var t={286:1};o.f.i=(e,i)=>{t[e]||importScripts(o.p+o.u(e))};var e=this.webpackChunkdigitaljs=this.webpackChunkdigitaljs||[],i=e.push.bind(e);e.push=e=>{var[s,r,n]=e;for(var a in r)o.o(r,a)&&(o.m[a]=r[a]);for(n&&n(o);s.length;)t[s.pop()]=1;i(e)}})(),e=o.x,o.x=()=>o.e(357).then(e),o.x()})()}));
//# sourceMappingURL=286.main.js.map